<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>7penis.net</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body style="margin:0;background:black;display:flex;align-items:center;justify-content:center;">
  <img id="hero" alt="" style="max-width:100%;max-height:100vh;" />

  <script>
    // --- CONFIG ---
    const BASE_FILE = "7penisdotnet.JPG"; // shown once per browser session
    const PREFIX = "7penisdotnet";        // numbered files
    const EXT = ".JPG";

    const MAX = 999;               // highest number to try
    const MISS_STREAK_LIMIT = 15;  // stop after this many consecutive misses
    const MAX_FOUND = 100;         // cap list size for speed

    // --- helpers ---
    function exists(src) {
      return new Promise(resolve => {
        const img = new Image();
        img.onload = () => resolve(true);
        img.onerror = () => resolve(false);
        img.src = src;
      });
    }

    function pickUniform(arr, avoid) {
      if (arr.length === 1) return arr[0];
      let pick = arr[Math.floor(Math.random() * arr.length)];
      if (avoid && pick === avoid) {
        pick = arr[(arr.indexOf(pick) + 1) % arr.length];
      }
      return pick;
    }

    function preload(src) {
      if (!src) return;
      const img = new Image();
      img.src = src;
    }

    async function discoverAvailable() {
      const available = [];
      let missStreak = 0;

      for (let i = 1; i <= MAX && available.length < MAX_FOUND; i++) {
        const file = `${PREFIX}${i}${EXT}`;
        if (await exists(file)) {
          available.push(file);
          missStreak = 0;
        } else {
          missStreak++;
          if (missStreak >= MISS_STREAK_LIMIT) break;
        }
      }
      return available;
    }

    async function main() {
      const hero = document.getElementById("hero");

      // 1) Show base image once per browser session
      if (sessionStorage.getItem("hasShownBase") !== "1") {
        hero.src = BASE_FILE;
        sessionStorage.setItem("hasShownBase", "1");
        sessionStorage.setItem("lastShown", BASE_FILE);

        const available = await discoverAvailable();
        const next = pickUniform(available, BASE_FILE);
        preload(next);
        sessionStorage.setItem("nextImage", next || "");
        return;
      }

      // 2) Uniform random among available numbered images
      const available = await discoverAvailable();
      if (available.length === 0) {
        hero.src = BASE_FILE;
        return;
      }

      const cachedNext = sessionStorage.getItem("nextImage") || "";
      const lastShown = sessionStorage.getItem("lastShown") || "";

      const current = (cachedNext && available.includes(cachedNext))
        ? cachedNext
        : pickUniform(available, lastShown);

      hero.src = current;
      sessionStorage.setItem("lastShown", current);

      // Preload next image
      const next = pickUniform(available, current);
      preload(next);
      sessionStorage.setItem("nextImage", next || "");
    }

    main();
  </script>
</body>
</html>
